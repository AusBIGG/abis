== Patterns

This section describes some modelling patterns implemented in ABIS. Most of these patterns are inherited from the models that ABIS profiles.

=== Set Modelling

The most basic pattern used by this model and all the <<OWL2, OWL>>-based models it profiles is that of https://en.wikipedia.org/wiki/Set_theory[Set Theory] modelling, that is, modelling according to the mathematical notion of sets.

The basic principles are that things - all things - can be modelled as atomic objects and groups of objects known as _sets_. The basic object/set relations (_membership_ of an object within a set) and set/set relations (_union_, _intersection_, _disjoint_ etc.) are likely familiar to all Australian high school graduates.

In OWL modelling, objects are usually called Named Individuals or Instances and sets are called Classes.

The set of all people, the class `Person` is defined like this:

----
ex:Person
    a owl:Class ;
    schema:name "Person" ;
    schema:description "Persons are individuals of the species Homo sapiens" ;
.
----

`Nicholas Car` is an object in the set of `Person` so, in OWL modelling, `Nicholas Car` is a  Named Individual of type `Person`:

----
ex:nicholasCar
    a ex:Person ;
    schema:name "Nicholas Car" ;
    schema:description "Nicholas is a Person, born in South Africa, now living in Brisbane" ;
.
----

Subsetting is very important in OWL: `Nicholas Car` might also be an `Engineer` where `Engineer` is defined as a subset of `Person`. This means every `Engineer` is also a `Person` but not all `Person` objects are `Engineers`:

----
ex:nicholasCar
    a ex:Engineer ;
    schema:name "Nicholas Car" ;
    schema:description "Nicholas is an Engineer, born in South Africa, now living in Brisbane" ;
.

ex:Engineer rdfs:subClassOf ex:Person .
----

In OWL modelling, classes may be seen by grouping instances with similar properties. `Nicholas Car` might be understood to be an Australian by virtue of the predicate `citizenship` being given for him indicating `Australian`:

----
ex:nicholasCar
    a ex:Person ;
    schema:name "Nicholas Car" ;
    ex:citizenship ex:Australian ;
.
----

The figure below shows Nicholas Car, the individual, declared as a `Person`, and `Engineer` and understood to be an `Australian`.

[#pattern-sets,link="img/patterns/sets.svg"]
.Set Modelling using OWL: The Named Individual `Nicholas Car` and three Classes he is a member of and which are subclasses of others.
image::img/patterns/sets.svg[Set Modelling,width=650,align="center"]

In the domain of ABIS, all animals living in the sea constitute the class marine animals and there are intersecting classes of terrestrial animals for things like crabs and penguins that live both in the sea and on land.

=== Identifiers

All complex objects in OWL modelling - classes, predicates and instances of classes - are identified either with an <<IRI, IRI>> or a <<BN, Blank Node>>. Classes and predicates defined in ABIS or inherited from models it profiles use the identifiers for them given in this document. Instances of classes, for example a particular sample, _Sample Y_ of the class https://linkeddata.tern.org.au/viewers/tern-ontology?uri=https://w3id.org/tern/ontologies/tern/Sample[`tern:Sample`], are identified by IRIs assigned to them often deriving from the IRI of the dataset in which they are first presented. If the instance is referred to again later - perhaps further observations were made on the sample - then the original identifier for the object is still used to allow linking of information. An example for _Sample Y_ in _Dataset X_ which also contains _Observation Z_:

----
<http://example.com/dataset/x>
    a schema:Dataset ;
    schema:hasPart
        <http://example.com/dataset/x/sample/y> ,
        <http://example.com/dataset/x/obs/z> ;
    dcterms:title "Dataset X" ;
.

<http://example.com/dataset/x/sample/y>
    a tern:Sample ;
    dcterms:title "Sample Y" ;
.

<http://example.com/dataset/x/obs/z>
    a tern:Observation ;
    sosa:hasFeatureOfInterest <http://example.com/dataset/x/sample/y> ;
    sosa:hasResult [
        a sosa:Result ;
        schema:value 42 ;
        schema:unitCode unit:PPM ;
    ] ;
    dcterms:title "Observation Z" ;
.
----

In the above example data, _Dataset X_ - `http://example.com/dataset/x` - contains _Sample Y_ - `http://example.com/dataset/x/sample/y` - and _Observation Z_  - `http://example.com/dataset/x/obs/z` - was on the sample. The demonstration IRIs clearly all build on Dataset X's.

The result of the observation - the value `42` parts per million uses a Blank Node, not an IRI, for identity which is essentially an unknown ID. This is because there's no point in referring to the Result other than via the `Observation` that recorded it, so no IRI is ever needed to directly refer to it from elsewhere. The Blank Node is seen here in the <<TURTLE, Turtle>> syntax of RDF with information given between `[` & `]`.

IRI identifiers for datasets take the form `https://{IRI-STEM}/{DATASET-ID}` and act as a unique namespace for objects within it. If Dataset `abc-123-def-456` contained Sample Y, we may have the following identifiers:

* *Dataset abc-123-def-456*: `+https://example.com/dataset/abc-123-def-456+`
** Dataset X's Namespace: `+https://example.com/dataset/abc-123-def-456/+` - ending in a '/'
* *Sample Y*: `+https://example.com/dataset/abc-123-def-456/sample/y+`
** Uses the Dataset Namespace and a class identifier (optional) of 'sample' and an ID for the particular sample - 'y'
** Datasets can create identifiers for their elements, within their namespace however they like

It is likely that initiatives will be created to manage data for Sites, Samples or other classes of object that ABIS knows about. If so, these initiatives might issue identifiers for those things and, if they do, those identifiers should be used. See the next section for how.

[discrete]
==== 5.2.1 Alternate Identifiers

Many objects represented using ABIS will usefully have external identifiers recorded, for example, samples with museum IDs or catalogue numbers. All forms of such identifiers _SHOULD_ be recorded and how they are recorded and used depends on their type.

[discrete]
===== Alternate IRIs

If an object already has an IRI identifier, and that identifier responds to <<LinkedData, Linked Data>> operations, it _SHOULD_ be used as the primary identifier of the object.

* If Dataset X contains a representation of Site Y and Site Y has the IRI of `https://linked.data.gov.au/dataset/ausplots-forest/site-nsfnnc0002` assigned to it by TERN, then that IRI _SHOULD_ be used as the IRI for the site as it is resolvable online, linking to RDF data (and human-readable data)
* If Dataset X contains a representation of Sample Z and Sample Z has an https://ev.igsn.org/[International GeoSample Identifier (IGSN)] or https://www.doi.org/[DOI] IRI of `https://doi.org/10.58052/IECUR00N9` then that IRI _MAY NOT_ be used as the IRI for the sample for, while it resolves online to a web page, it does not link to RDF data

If an object has a Linked Data IRI assigned to it AND another assigned to it within an ABIS data generation process, perhaps automatically, the two IRIs should be linked like this:

----
<{ORIGINAL-IRI}> owl:sameAs <{NEW-IRI]}>
----

Here the <<OWL2, OWL>> predicate http://www.w3.org/2002/07/owl#sameAs[`owl:sameAs`] indicates the two IRIs identify the same thing.

If an object has an IRI assigned to it that does not link to RDF data, it should be recorded in the following manner:

----
<{NEW-IRI]}>
    schema:identifier "{ORIGINAL-IRI}"^^{CUSTOM-DATATYPE} ;
    ...  # other properties
.
----

Here the `{ORIGINAL-IRI}`, since it does not act as a Linked Data IRI, is indicated as being a literal of a specialised data type - `{CUSTOM-DATATYPE}`.

If the datatype of the `{ORIGINAL-IRI}` is of a known form, such as a DOI or IGSN, then that type might be found in the _BDR Datatypes_ vocabulary at https://vocabs.bdr.gov.au/v/vocab[https://vocabs.bdr.gov.au], and it should be used. If its type is not known or is a generic URL, the type `xsd:anyURI` should be used like this:

----
<{NEW-IRI]}>
    schema:identifier "{ORIGINAL-IRI}"^^xsd:anyURI ;
    ...  # other properties
.
----

All special IRI types, such as DOI, should be recorded in the _BDR Datatypes_ vocabulary

[discrete]
===== Alternate IDs - non-IRIs

Alternate identifiers for objects that are not IRIs/URLs _MUST_ have their identifier regime indicated. For example, if Museum X issues identifiers for samples and Sample Y has an issued identifier of `SAM-Y1234`, then this should be given like this:

----
<{SAMPLE-IRI]}>
    a tern:Sample ;
    schema:identifier "SAM-Y1234"^^ex:museum-x-id ;
    ...  # other properties
.
----

...where `{SAMPLE-IRI}` is an IRI assigned to the _sample_ and the predicate `schema:identifier` is used to give the literal identifier value of `SAM-Y1234` which has the datatype `ex:museum-x-id` indicated.

[NOTE]
====
The https://bdr.gov.au[Biodiversity Data Repository] requires that all non-IRI alternate IDs used in submissions of data to it be registered within its https://vocabs.bdr.gov.au/v/vocab[BDR Datatypes] vocabulary.
====

Multiple alternate identifiers may be given, as long as their datatypes are unique:

----
<{SAMPLE-IRI]}>
    a tern:Sample ;
    schema:identifier
        "SAM-Y1234"^^ex:museum-x-id ,
        "1073/SAMY"^^ex:igsn ;
    ...  # other properties
.
----

=== Data Cataloguing

ABIS provides representations of chunks of data for management - cataloguing, data governance and so on. It does this by implementing a very simple, and common, catalogue model which consists of _catalogues_ (or _catalogs_, for Americans) that contain _datasets_ or other kinds of _resources_  such as _vocabularies_. ABIS then allows some _datasets_ to indicate they, contain _biodiversity records_ about occurrences and so on.

This models is as per <<#cat-model-overview-pattern, Figure 4>>, below, which is taken from the <<Annex A: Biodiversity Record Model, Biodiversity Record Model>>, detailed in full in Annex A.

Since this model is used for data management, it places requirements on ABIS datasets, above and beyond those imposed by the models it profiles, such as the <<TERNOntology, TERN Ontology>>, to data management metadata requirements are met.

[#cat-model-overview-pattern,link="img/annex-a/brm-overview.svg"]
.An overview of the Biodiversity Record Model's classes and their relationships
image::img/annex-a/brm-overview.svg[Biodiversity Record Model overview,align="center",width=150]

=== Records & Occurrences

ABIS is fundamentally about records of the occurrence of biodiversity. For this reason, ABIS contains representations of chunks of data, as per the <<Data Cataloguing, Data Cataloguing>> pattern above, a  representation of an _occurrence_ and a mechanism to link them.

The ABIS class <<abis:BiodiversityRecord, BiodiversityRecord>> represents a single recording of an occurrence or recording of the results of a survey. This is usually a single row in a spreadsheet of biodiversity observations, or a single point of a map of occurrences. It is linked to the representation of actual occurrence itself, represented by the <<DWC, Darwin Core Terms>>'s <<dwc:Occurrence, Occurrence>> class.

The reason for this distinction between representations of the _record of the occurrence_ and the _occurrence_ itself is because some data models record metadata about the recording itself - who did it, where it is stored and managed, what ID the recording has etc. - and some don't, choosing to focus only on the where/what/when of the occurrence.

[NOTE]
====
For data in the ABIS format being submitted to systems such as the <<BDR, Biodiversity Data Repository>> where the data origin has a "Record ID" or similar, this ID should be preserved as a property of instances of the <<abis:BiodiversityRecord, Biodiversity Record>> class as a non-IRI alternate identifier, as per the <<Alternate IDs - non-IRIs, Alternate IDs - non-IRIs>> pattern.
====

The relationship between a <<abis:BiodiversityRecord, Biodiversity Record>> and the <<dwc:Occurrence, Occurrence>> it is about is given with the <<schema:about, schema:about>> predicate, like this:

[source,turtle]
----
ex:record-1234
    a abis:BiodiversityRecord
    # ... other info
    schema:about ex:occurrence-9876 ;  # <-- this is the link
.

ex:occurrence-9876
    a dwc:Occurrence ;
    schema:spatial [
        a geo:Geometry ;
        geo:asWKT "POINT (...)" ;
    ] ;
    schema:temporal "2024-07-29"^^xsd:date ;
    # ... other info
.
----

=== Spatially

_ABIS inherits its spatial modelling from <<GSP, GeoSPARQL>>, as does the <<TERNOntology, TERN Ontology>>._

Patterns:

* <<Feature-centric, Feature-centric>>
* <<ABIS spatial objects, ABIS spatial objects>>
* <<Qualified Geometries, Qualified Geometries>>
* <<Centroid & Bounding Box, Centroid & Bounding Box>>
* <<Geometry Literals, Geometry Literals>>
* <<Aggregation Reasoning, Aggregation Reasoning>>
* <<Coordinate System, Coordinate System>>
* <<Elevation & Depth, Elevation & Depth>>

[discrete]
==== Feature-centric

GeoSPARQL uses a "feature-centric" method of spatial modelling which means spatial things are represented as conceptual things first - spatial _features_ - and then a spatial projection or representation - _geometry_ - is linked to it. This is different to some GIS systems that model spatial things as geometries first and then apply properties to them.

[#pattern-spatiality-basic,link="img/patterns/spatiality-basic.svg"]
.A `Feature`, such as a `Site`, can be assigned a `Geometry` with any one of a number of representations. ABIS prefers the https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry[Well-Known Text] representation of coordinates.
image::img/patterns/spatiality-basic.svg[Basic GeoSPARQL,width=650,align="center"]

The RDF data for the example above is:

[source,turtle]
----
PREFIX ex: <http://example.com/>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX schema: <https://schema.org/>
PREFIX tern: <https://w3id.org/tern/ontologies/tern/>

ex:site-x
    a tern:Site ;
    schema:name "Site X" ;
    schema:spatial [
        a geo:Geometry ;
        schema:name "Geometry X1" ;
        geo:asWKT "POLYGON ((...))"^^geo:wktLiteral ;
    ] ;
.
----

[discrete]
==== ABIS spatial objects

There are multiple classes of spatial objects in ABIS. The following are always spatial, even when their spatial values - their geometries - are unknown:

* `Observation`
* `Site`
* `Sample` - where the sample was collected from, not where it is now

For these classes of object, we expect to see instances of them to be associated with geometries, if known.

The following classes of object are either given as spatial - a geometry is provided - or for their spatial values to be inferred from child object geometries - see <<Aggregation Reasoning, Aggregation Reasoning>> below:

* `schema:Dataset`
* `tern:Survey`

A `Survey` might have its spatial extent recorded directly or taken to be the envelope of the locations of the `Observations` it contains. Similarly, an ABIS `schema:Dataset` will either have an extent - the extent of all the data within it - given or calculated from its contained objects, which may be `Sites`, `Sample`, `Survey` or `Observation` instances, or all of them.

[discrete]
==== Qualified Geometries

This feature-centric model allows for multiple or no geometries per spatial object which can be very powerful. The figure below gives several examples of a spatial Feature with multiple Geometries that differ different ways. The pattern here is "qualification": when a Feature is assigned multiple Geometries, they must be differentiable in some way, either by having different geometry types (point, polygon etc.) or by having different roles with respect to the Feature or by each Geometry indicating a different temporal footprint. These differentiations qualify the Geometries with respect to the Feature.

[#pattern-spatiality,link="img/patterns/spatiality-qual.svg"]
.Spatial `Features` and `Geometries` as modelled in the <<GSP, GeoSPARQL>> ontology with subfigure *A.* showing a `Site` feature that has two geometries provided for it: a Point and a Polygon. These could respectively represent the site's centroid and is boundary and are differentiable by geometry type. Subfigure *B.* shows a feature - Saint Helena Island - with two boundary polygonal geometries differentiated by _role_. Subfigure *C.* shows a time-varying feature, a cyclone, with multiple geometries differentiated by time. Data for *B.* is given in the ABIS repository at https://github.com/AusBIGG/abis/tree/master/examples - see the file `pattern-spatiality-saint-helena-island`.
image::img/patterns/spatiality-qual.svg[Basic PROV classes and predicates,width=850,align="center"]

[discrete]
==== Centroid & Bounding Box

[#pattern-spatiality-pomingalarna,link="img/patterns/spatiality-pomingalarna.png"]
.The field site 'Pomingolarna' with bounding box, boundary and centroid geometries indicated
image::img/patterns/spatiality-pomingalarna.png[Pomingolarna site example,width=850,align="center"]

While it is possible to supply point and polygon geometries for a spatial object's centroid, boundary and bounding box, a centroid and a bounding box are calculable from a boundary and should not be supplied if the boundary is known: ABIS data users, such as the <<BDR, BDR>>, will calculate them as needed. This rule is listed in ABIS' <<Reasoning Rules, Reasoning Rules>> section. In the image above, the bounding box and centroid have been calculated from the boundary.

If only a centroid or a bounding box is known for a spatial object, then specific predicates from <<GSP, GeoSPARQL>> - https://opengeospatial.github.io/ogc-geosparql/geosparql11/spec.html#geo:hasCentroid[`geo:centroid`] & https://opengeospatial.github.io/ogc-geosparql/geosparql11/spec.html#geo:hasBoundingBox[`geo:hasBoundingBox`] - should be used to indicate that this is the type of geometry known, as opposed to a boundary or a general point for a point location which are indicated with the general-purpose https://opengeospatial.github.io/ogc-geosparql/geosparql11/spec.html#geo:hasGeometry[`geo:hasGeometry`] predicate. The RDF data example below is the data for the image above showing the predicates in use.

[source,turtle]
----
PREFIX ex: <http://example.com/>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX schema: <https://schema.org/>
PREFIX tern: <https://w3id.org/tern/ontologies/tern/>

ex:pomingolarna
    a tern:Site ;
    schema:name "Pomingalarna Bushland Site" ;
    geo:hasCentroid [
        geo:asWKT "POINT (147.300797 -35.113046)" ;
    ] ;
    schema:spatial [
        a geo:Geometry ;
        schema:name "Boundary" ;
        geo:asWKT "POLYGON ((147.294576 -35.101881, 147.299386 -35.102425, 147.303469 -35.106577, 147.302879 -35.109889, 147.305057 -35.111953, 147.307076 -35.113405, 147.311296 -35.113541, 147.310887 -35.115810, 147.311772 -35.115991, 147.310093 -35.117738, 147.310071 -35.117398, 147.309118 -35.116967, 147.308460 -35.117262, 147.308006 -35.118147, 147.307938 -35.120438, 147.308120 -35.120869, 147.308278 -35.122434, 147.308324 -35.123387, 147.306849 -35.123569, 147.306350 -35.123387, 147.304558 -35.123092, 147.302743 -35.122548, 147.301473 -35.121844, 147.300293 -35.121073, 147.292240 -35.113042, 147.294576 -35.101881))" ;
    ] ;
    geo:hasBoundingBox [
        geo:asWKT "POLYGON ((147.292240 -35.123569, 147.311772 -35.123569, 147.311772 -35.101881, 147.292240 -35.101881, 147.292240 -35.123569))" ;
    ] ;
.
----

[discrete]
==== Geometry Literals
ABIS only allows for https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry[Well-Known Text representations of geometries] indicated by the `geo:asWKT` predicate. No other forms of geometry literal, e.g. GeoJSON, may be used.

ABIS will infer that any literal object indicated with the `geo:asWKT` predicate is of the datatype `geo:wktLiteral` and the literal typing need not be supplied. It may also be supplied so the following are treated as equivalent:

`geo:asWKT "POINT (147.300797 -35.113046)" ;`

`geo:asWKT "POINT (147.300797 -35.113046)"geo:wktLiteral ;`

This is as per a rule in the <<Spatial Reasoning, Spatial Reasoning>> part of the rules section.

[discrete]
==== Coordinate System

All spatial data supplied according to ABIS _MUST_ use the GDA2020 Coordinate Reference System. Systems such as WGS84, GDA94 or others _MUST NOT_ be used.

Since spatial data formulated according to GeoSPARQL only use the Well-Known Text format - see the <<Geometry Literals, Geometry Literals>> section above - and that format defaults to OGC:CRS84, the use of GDA2020 must be indicated in the WKT, as per the https://docs.ogc.org/is/22-047r1/22-047r1.html#_rdfs_datatype_geowktliteral[GeoSPARQL WKT guidance] using the IRI `http://www.opengis.net/def/crs/EPSG/0/7844` or `https://epsg.io/7844` for the CRS. Remember when converting from OGC CRS84 (the default WKT crs) to GDA2020 the axis order must also be reversed. For example, a `POINT` at `(123.0 -45.0)` would have WKT like this:

----
"<https://epsg.io/7844> POINT (-45.0 123.0)"geo:wktLiteral
----

[discrete]
==== Aggregation Reasoning

ABIS contains rules that will perform spatial reasoning on data. For example, if a dataset is presented that contains a https://w3id.org/tern/ontologies/tern/Survey[`Survey`] which, in turn, contains a series of https://w3id.org/tern/ontologies/tern/Observation[`Observation`] instances with their spatial locations indicated, the spatial extent of the `Survey` will be taken to be at least the area containing the `Observation` locations. The dataset's extent will be at least the boundary of all contained `Survey` instances areas. Spatial reasoning like this and other reasoning are related in ABIS' <<Reasoning Rules, Reasoning Rules>> section.

The figure below shows a boundary calculated for a series of point locations. The boundary could be the extent of a `Survey` for `Observation` point locations and this type of boundary - a convex hull - is the minimum non-concave area containing all points.

[#pattern-spatiality-hull,link="img/patterns/spatiality-hull.png"]
.A convex hull boundary - in green - calculated for a series of point locations - in yellow.
image::img/patterns/spatiality-hull.png[Convex hull for points,width=650,align="center"]

[discrete]
==== Feature relations

In addition to associating spatial Features with one or more Geometries, GeoSPARQL, and thus ABIS, allows for Feature-to-Feature (topological) spatial relations between pairs of Features to be recorded. There are multiple allowed relation families in GeoSPARQL but ABIS prefers use of the https://opengeospatial.github.io/ogc-geosparql/geosparql11/spec.html#_simple_features_relation_family[_Simple Features_ relations] which are summarised as follows:

[cols="1,1,3"]
|===
| Name | GeoSPARQL Predicate | Meaning

| equals        | `geo:sfEquals`        | The spatial extents of the two objects are exactly the same
| disjoint      | `geo:sfDisjoint`      | The spatial extents of the two objects do not touch or overlap
| intersects    | `geo:sfIntersects`    | The spatial extents of the two objects have at least one point in common
| touches       | `geo:sfTouches`       | The spatial extents of the two objects have at least one point in common, but their interiors do not intersect (i.e. only their boundaries intersect)
| within        | `geo:sfWithin`        | The spatial extent of the first object is wholly contained by the spatial extent of the second object
| contains      | `geo:sfContains`      | The spatial extent of the first object wholly contains the spatial extent of the second object (i.e. the inverse of _within_)
| overlaps      | `geo:sfOverlaps`      | The spatial extents of the two objects have some, but not all, points in common, and the dimensions of the intersection are the same as those of the objects
| crosses       | `geo:sfCrosses`       | The spatial extents of the two objects have some, but not all, interior points in common and the dimensions of intersection is less than the dimensions of at least one of them (i.e. two 2-D areas' intersection is a 1-D line or two lines' intersection is a 0-D point)
|===

The most commonly used spatial relations are _contains_/_within_ and _overlaps_. Here are some examples of Feature-to-Feature relations for real and example Features:

[source,turtle]
----
PREFIX ex: <http://example.com/>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX schema: <https://schema.org/>
PREFIX tern: <https://w3id.org/tern/ontologies/tern/>

# Australia, according to the Australian Bureau of Statistics' ASGS Linked Data dataset
<https://linked.data.gov.au/dataset/asgsed3/AUS/AUS>
    a geo:Feature ;
    schema:name "Australia" ;
    geo:sfContains
        <https://linked.data.gov.au/dataset/asgsed3/STE/8> ,  # ACT
        <https://linked.data.gov.au/dataset/asgsed3/STE/1> ,  # NSW
        <https://linked.data.gov.au/dataset/asgsed3/STE/7> ,  # NT
        # ...
        <https://linked.data.gov.au/dataset/asgsed3/STE/2> ;  # Victoria
.

<https://linked.data.gov.au/dataset/asgsed3/STE/1>  # NSW
    a geo:Feature ;
    schema:name "New South Wales" ;
    geo:sfWithin <https://linked.data.gov.au/dataset/asgsed3/AUS/AUS> ;
.

# An example Site within NSW
ex:site-x
    a tern:Site ;
    schema:name "Site X" ;
    geo:sfWithin <https://linked.data.gov.au/dataset/asgsed3/STE/1> ;
.
# ex:site-x geo:sfWithin <https://linked.data.gov.au/dataset/asgsed3/AUS/AUS>
# can be inferred from the site being within NSW being within Australia

# NSW & Victoria touch along their common border
<https://linked.data.gov.au/dataset/asgsed3/STE/1>
    geo:sfTouches <https://linked.data.gov.au/dataset/asgsed3/STE/2> ;
.
----

GeoSPARQL provides function definitions for the calculation of Feature-to-Feature relations from geometry data and all compliant implementations of GeoSPARQL allow these calculations to result in declarations of equivalent predicates. So if object A is calculated as being _within_ object B, then the RDF triple `<A> geo:sfWithin <B>` may be recorded.

[discrete]
==== Elevation & Depth

[discrete]
===== Absolute

If the absolute elevation or depth of an object needs representation, the 2D + Z forms of https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry[Well-Known Text representation of a geometry] should be used: `POINTZ`, `LINESTRINGZ` & `POLYGONZ`.

For example, if _Observation N_ was made at longitude 147.308040 E, latitude 35.121824 S at an elevation of 234 metres, `POINTZ` should be used like this:

[source,turtle]
----
PREFIX ex: <http://example.com/>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX schema: <https://schema.org/>
PREFIX tern: <https://w3id.org/tern/ontologies/tern/>

ex:obs-n
    a tern:Observation ;
    schema:name "Observation N" ;
    schema:spatial [
        geo:asWKT "POINTZ(147.308040 -35.121824 234)" ;
    ] ;
.
----

Depth should be similarly indicated with a `POINTZ` WKT representation with the `Z` value given as a negative, i.e. 20m below sea level should be `-20`.

[discrete]
===== Relative

If relative elevation or depth needs representation, the <<SDO, schema.org>> https://schema.org/elevation[`schema:elevation`] & https://schema.org/depth[`schema:depth`] should be used.

For example, if a `Sample` is obtained 3m below ground surface at longitude 147.308040 E, latitude 35.121824 S, it should be recorded like this:

[source,turtle]
----
PREFIX ex: <http://example.com/>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX schema: <https://schema.org/>
PREFIX tern: <https://w3id.org/tern/ontologies/tern/>

ex:obs-n
    a tern:Observation ;
    schema:name "Observation N" ;
    schema:spatial [
        geo:asWKT "POINT(147.308040 -35.121824)" ;
    ] ;
    schema:depth [
        schema:value 3 ;
        schema:unitCode <https://qudt.org/vocab/unit/M> ;  # QUDT's IRI for metre
    ] ;
.
----

Elevation and depth values should use positive numbers only.

If a simple value for depth is given, e.g. `ex:obs-n schema:depth 3`, this will be interpreted as being in metres.

=== Temporality

[discrete]
==== Feature-centric

_ABIS inherits its temporal modelling from the <<TIME, Time Ontology>>. The <<TERNOntology, TERN Ontology>> uses the Time Ontology in places and used direct time representations elsewhere. This may be harmonised in the future._

ABIS uses a feature-centric approach for temporality, just as it does with spatiality. Just as per <GSP, GeoSPARQL>> where spatial objects are conceptual things with associated geometries, following <<TIME, OWL TIME>>, temporal objects are conceptual things with associated temporal "geometries" or temporal footprint.

Where for spatial objects we link a `Feature` to a `Geometry` which in turn links to a literal representation of the spatial footprint, say a Well-Known Text polygon, for temporal objects we link the temporal feature to a https://www.w3.org/TR/owl-time/#time:TemporalEntity[`time:TemporalEntity`], the equivalent of a temporal geometry, which is either a https://www.w3.org/TR/owl-time/#time:Instant[`time:Instant`] or a https://www.w3.org/TR/owl-time/#time:Interval[time:Interval`] which then contains dates, date/times etc.

The following code shows several example `Survey` instances, which are temporal features, linked to different temporal entities. The selection of particular temporal entities will come down to what is known about the `Survey`.

[source,turtle]
----
PREFIX ex: <http://example.com/>
PREFIX schema: <https://schema.org/>
PREFIX tern: <https://w3id.org/tern/ontologies/tern/>
PREFIX time: <http://www.w3.org/2006/time#>

# Survey X started on the 15th of March, 1987
# and ended on the 23 of March, 1987
ex:survey-x
    a tern:Survey ;
    schema:name "Survey X" ;
    schema:temporal [
        time:hasBeginning [ time:inXSDDate "1987-03-15" ] ;
        time:hasEnd [ time:inXSDDate "1987-03-23" ] ;
    ] ;
.

# We only know Survey Y occurred in April, 2010
ex:survey-y
    a tern:Survey ;
    schema:name "Survey Y" ;
    schema:temporal [
        time:inXSDgYearMonth "2020-04"
    ] ;
.

# Survey Z is on-going or at least
# we don't know if/when it ended as only
# a beginning date is given
ex:survey-z
    a tern:Survey ;
    schema:name "Survey Z" ;
    schema:temporal [
        time:hasBeginning [ time:inXSDDateTime "2023-12-10T14:30:00" ] ;
    ] ;
.
----

[discrete]
==== Date & Time representations
OWL TIME allows a number of data and time literal representations for date/time instants and any may be used: use the one that best corresponds with the reality of the thing you are modelling. The code example above shows three different ones in use: `xsd:date`, `xsd:gYearMonth` and `xsd:dateTime`.

The following table gives a list of date/time data types and the OWL TIME predicate used to indicate them. Format values in the table below use the codes from https://strftime.org/, for example `%Y` is "Year with century as a decimal number" e.g. 2013, not 13.

|===
| Datatype | Indicating Predicate | Format | Example | Use

| `xsd:dateTimeStamp` | https://www.w3.org/TR/owl-time/#time:inXSDDateTimeStamp[`time:inXSDDateTimeStamp`]  | `%Y-%m-%dT%H:%I:%S%z` | `2013-07-24T15:17:12.55+1000` | To indicate a time - to the second or part of a second - with a known timezone
| `xsd:dateTime` | https://www.w3.org/TR/owl-time/#time:inXSDDateTime[`time:inXSDDateTime`]                 | `%Y-%m-%dT%H:%I:%S`   | `2013-07-24T15:17:12.55` | To indicate a time - to the second or part of a second - without a known timezone
| `xsd:date` | https://www.w3.org/TR/owl-time/#time:inXSDDate[`time:inXSDDate`]                             | `%Y-%m-%d`            | `2013-07-24` | To indicate a date with time unknown or irrelevant
| `xsd:gYearMonth` | https://www.w3.org/TR/owl-time/#time:inXSDgYearMonth[`time:inXSDgYearMonth`]           | `%Y-%m`               | `2013-07` | To indicate a month in a particular year
| `xsd:gYear` | https://www.w3.org/TR/owl-time/#time:inXSDgYear[`time:inXSDgYear`]                          | `%Y`                  | `2013` | To indicate a year
|===

Note that when you use the predicates listed in the table above, ABIS will infer the datatype of the object indicated by the predicate and give an error if the data cannot be parsed as that datatype. You do not need to specify the datatype but you must get the format correct.

[NOTE]
====
Models that ABIS inherits from sometimes include seemingly arbitrary data/time restrictions, such as <<SOSA, SOSA>> requiring that a https://www.w3.org/TR/vocab-ssn/#SOSAresultTime[sosa:resultTime`] only be used to indicate an `xsd:dateTime`. ABIS ignores such restrictions: you may use the date or time representation best suited to convey the real-world reality of your objects' temporality of any temporal indication predicate.
====

=== Provenance

How things derive from other things, when and where this occurs and who may be responsible for actions is the domain of the <<PROV, Provenance Ontology (PROV)>> which is one of ABIS's Background Models.

PROV's basic classes and the predicates that relate them to one another are given below.

[#pattern-prov-basic,link="img/patterns/prov-basic.svg"]
.Basic PROV classes and predicates
image::img/patterns/prov-basic.svg[Basic PROV classes and predicates,width=550,align="center"]

Many of ABIS' models follow on from the pattern in the figure above and many figures further down in this document are coloured according to PROV's basic classes. For example, the <<TERNOntology, TERN Ontology>>'s https://linkeddata.tern.org.au/viewers/tern-ontology?uri=https://w3id.org/tern/ontologies/tern/Sampling[`Sampling`] class is a subclass of PROV's https://www.w3.org/TR/prov-o/#Activity[`Activity`] class and instances of it may have https://www.w3.org/TR/prov-o/#used[`used`] an instance of a https://linkeddata.tern.org.au/viewers/tern-ontology?uri=https://w3id.org/tern/ontologies/tern/Site[`Site`], which is a subclass of PROV's https://www.w3.org/TR/prov-o/#Activity[`Entity`], to have https://www.w3.org/TR/prov-o/#generated[`generated`] an instance of the class https://linkeddata.tern.org.au/viewers/tern-ontology?uri=https://w3id.org/tern/ontologies/tern/Sample[`Sample`] which is another subclass of https://www.w3.org/TR/prov-o/#Entity[`Entity`].

The figures in the <<Observations & Results, Observations & Results>> and the <<Feature of Interest, Feature of Interest>> patterns use this colouring.

PROV's provenance reasoning is also applicable to parts of ABIS. For example, the https://linked.data.gov.au/def/bdr-pr[BDR Profile]'s https://linked.data.gov.au/def/bdr-pr/proj[Project Model] indicates that instances of the https://schema.org/Project[`schema:Project`] class, which is a subclass of PROV's https://www.w3.org/TR/prov-o/#Activity[`Activity`], can have https://www.w3.org/TR/prov-o/#generated[`generated`] instances of `schema:dataset` class, which is a subclass of PROV's https://www.w3.org/TR/prov-o/#Entity[`Entity`], and may have been associated with an https://www.w3.org/TR/prov-o/#Agent[`Agent`] - an Organisation or Person. If so, then the resulting `schema:Dataset` instances will be understood, by inferencing, to have an attribution relationship to the `Agent` instance. This is shown in the figure below.

[#pattern-prov-reasoning,link="img/patterns/prov-reasoning.svg"]
.PROV-style reasoning using facts given in the https://linked.data.gov.au/def/bdr-pr[BDR Profile]'s https://linked.data.gov.au/def/bdr-pr/proj[Project Model]
image::img/patterns/prov-reasoning.svg[PROV-style reasoning,width=350,align="center"]

=== Agents

Things with agency to do work such as Organisations, People, Groups (of orgs and people) and perhaps software systems - are modelled as _Agents_ in many Semantic Web and Knowledge Graph systems. In ABIS, we follow the general pattern for Agents outlined in the <<PROV, Provenance Ontology (PROV)>>, see the section above.

In addition to the simple and direct kind of relationship between `Agents` and data (`Entities`) show above in <<#pattern-prov-reasoning, Figure 9>> where an `Entity` can be attributed to an `Agent`, we use a nuanced version of that `was attributed to` relationship, `qualified attribution`, which is also defined in PROV. `qualified attribution` is a type of _qualified relation_ which means it relates two things together with qualifying facts. While these qualifying facts can be anything, in ABIS, the expected qualifier is a role: a role that the `Agent` plays with respect to the `Entity`. For example, for a dataset, one `Agent` might be the _author_ of the data, another the _publisher_. This could be modelled as in <<#pattern-prov-qualatt, Figure 10>>, below.

[#pattern-prov-qualatt,link="img/patterns/agent-multi.svg"]
.Two `Agents`, `Y` & `Z`, related to a single dataset `X` with different roles using the `qualified attribution` predicate from <<PROV, PROV>>
image::img/patterns/agent-multi.svg[PROV-style reasoning,width=700,align="center"]

The roles that can be used for the qualification of attribution in ABIS are open-ended - new ones can be defined - but they are controlled - they must be proposed and accepted into a vocab to be legitimate. The vocab ABIS uses for these roles is the _IDN Role Codes vocabulary_ - see the <<Vocabularies, Vocabularies>>. It contains concepts such as _author_, _publisher_, _collaborator_ and _funder_.

=== Observations & Results

_This pattern is inherited from the <<TERNOntology, TERN Ontology>>, which, in turn, inherits it from <<SOSA, SOSA>>._

The _result_ of any _observation_ in ABIS is a numerical or classification _value_ for an _observed property_ of a _feature of interest_ (see next pattern).

The _observation_ act is a temporal activity which, recorded or not, follows some _procedure_.

The _value_ may be qualified with units of measure and uncertainty.

[#pattern-obs-result,link="img/patterns/obs-result.svg"]
.Two styles of Result: a numerical and a classification
image::img/patterns/obs-result.svg[ABIS Parts,align="center",width=650]

Using this pattern, the thing that ties the result value to the property of the thing observed is the _observation_.

NOTE:: Since _observations_ record when a result was produced, multiple observations of the property of a thing can be recorded over time, such as multiple estimations of the taxon of a specimen.

=== Feature of Interest

A _feature of interest_ is the object of some activity's focus. This is a relative term: when an _observation_ considers the property of something - perhaps the colour of a part of a leaf - then the part leaf only - a sample of it - is the _feature of interest_. If the _observation_ were to consider the colour of the whole leaf, then the leaf is the _feature of interest_. If the colour of the whole bush from which the leaf came was considered, then the whole bush is the _feature of interest_.

If the average colour of a whole area of bushland was considered, the _feature of interest_ would be the whole area, not any single bush or plant within it.

[#pattern-foi,link="img/patterns/foi.svg"]
.Three Features if Interest indicated with respect to the Observation that is observing properties of them. Whether something is a sample of something else doesn't affect its status as a Feature of Interest with respect to an Observation.
image::img/patterns/foi.svg[ABIS Parts,width=650,align="center"]

=== Sites

A _site_ is a special kind of _feature of interest_ with a particular definition in the domain of biodiversity science. As per the TERN Ontology, a `Site` in ABIS is:

"An ecological monitoring site where observations and samplings occur"

So when we see a _site_ in ABIS, we know that it is the focus of the activity of ecological monitoring and not some other form of "site", for example an administrative region.

Additionally, a TERN/ABIS _site_ is also a form of _sample_ in that the activity at the ecological monitoring is designed to characterise biodiversity at the site where it is representative of an ultimate _feature of interest_ - perhaps a certain kind of habitat. The _site_ might be the entire ultimate _feature of interest_ too in cases where a _site_ is the entire area of concern such as a proposed mine location.

ABIS _site_ s _MUST_ have spatiality and temporality indicated as per the <<Spatially, Spatially>> & <<Temporality, Temporality>> patterns above.

ABIS _site_ s _MAY_ have additional information about them (such as sub areas, _transects_, _subplots_, methods used etc.) recorded for them according to particular protocols, such as the https://www.tern.org.au/emsa-protocols-manual[Ecological Monitoring System Australia (EMSA) protocols]. Adherence to such protocols _MAY_ result in addition RDF data being linked to an ANSI _site_ or additional textual or other literal information but it _MUST NOT_ conflict with the ABIS _site_ information requirements.

Detailed _site_ modelling according to EMSA or similar protocols should result in extension models to ABIS, just as the <<Projects Model, Projects Model>> is an extension.
